<div class='relative2'>
  <h1> Physicians Time Away Schedule</h1>
</div>

<div class='relative'>

<img src="assets/prevMonthArrow.png"  (click) = 'advanceMonth(-1)'  alt="image">
<img src="assets/nextMonthArrow.png" (click) = 'advanceMonth(1)'  alt="image">
</div>

<table id="myTable" border="1" class="cal" *ngIf = "vacData"  style="border-collapse: collapse; background-color:rgb(239, 214, 208)" cellpadding="2">
<tr>
  <td [attr.colspan] = 'calParams.daysInFirstMonth'> {{ calParams.firstMonthName }} </td>
  <td [attr.colspan] = 'calParams.daysInSecondMonth'> {{ calParams.secondMonthName }}  </td>
</tr>
<tr>
  <td *ngFor = "let d of calDates" [className] ="getDateClass(d )"  >
    {{ d.getDate()}}
  </td>
</tr>

<tr *ngFor = "let item of vacData | keyvalue" > {{ zeroDayNum() }}
  <td   *ngFor='let loop3 of counter(item.value[0].daysTillStartDate ) ;let ip= index' [className] = 'getClass( item.value[9][0][ip])' >   </td>
  <td [attr.colspan] = 'item.value[0].vacLength' class = "green" (click) = "showEditFunc(item.value[0])"   >   {{ item.value[0]['LastName'] }}  </td>

  <ng-container *ngIf = 'item.value[1]'> 
   <td *ngFor= 'let loop4 of counter(daysBetween(item.value[0], item.value[1])) ;let ip= index' [className] = 'getClass( item.value[9][1][ip])' > 
            </td>
   <td [attr.colspan] = 'item.value[1].vacLength' class = "green"  (click) = "showEditFunc(item.value[1])"      >   {{ item.value[1]['LastName'] }}  </td>
  </ng-container> 


  <ng-container  *ngIf = '!item.value[1] && item.value[9][1]'  > 
    <td *ngFor = "let lp of counter( item.value[0]['daysTillCalEnd']); let ip=index"    [className] = 'getClass( item.value[9][1][lp])'  > 
      <div *ngIf= 'item.value[9][1]' > 
      </div>
    </td> 
  </ng-container>
  

  <ng-container *ngIf = 'item.value[2]'> 
    <td *ngFor= 'let loop5 of counter(  daysBetween(item.value[1], item.value[2])); let ip = index'  [className] = 'getClass( item.value[9][2][ip])'  > </td>
    <td [attr.colspan] = 'item.value[2].vacLength'  class = "green"  (click) = "showEditFunc(item.value[2])" >{{ item.value[1]['LastName'] }}</td>
   </ng-container> 
   <ng-container *ngIf = '!item.value[3] && item.value[2] && item.value[9][3]' >
   <td  *ngFor = "let lp of item.value[2][10]; let ip=index"  > 
     <div *ngIf='item.value[9][3]' >
       </div>
    </td>
   </ng-container>

   <ng-container *ngIf = '!item.value[2] && item.value[1]'>
     <td *ngFor='let l3 of counter( daysTillEnd(item.value[1]));  let ip = index' 
      [className] = 'getClass( item.value[9][2][ip])'  
       > 
      <div   *ngIf = 'item.value[9][2]'>   </div> 
       </td>
   </ng-container>

   <ng-container *ngIf = 'item.value[3]'> 
    <td *ngFor= 'let loop6 of counter( daysBetween(item.value[2], item.value[3])); let ip = index ' [className] = 'getClass( item.value[9][3][ip])'     > </td>
    <td [attr.colspan] = 'item.value[3].vacLength'  class = "green" (click) = "showEditFunc(item.value[3])"  >{{ item.value[2]['LastName'] }} </td>
   </ng-container> 
   <ng-container *ngIf = '!item.value[4]  && item.value[3] && item.value[3][10] '>
    <td *ngFor='let l3 of  item.value[3][10] ;  let ip = index'  > 
      <div *ngIf = 'item.value[9][4]' > </div> </td>
  </ng-container>
</tr>
</table>

<div class='spacer'  >
  <div class='raised' *ngIf = showEdit >
      <table class='toFit' *ngIf = showEdit >
          <caption> {{ theCaption }} Edit Time Away  {{ vidxToEdit }}</caption>
        <tr *ngIf = !readOnly>
            <th> Start Date</th>
            <th> End Date</th>
            <th> Reason </th>
            <th> Note </th>
        </tr>  
        <tr>
        <td class='h50'>
          <div class='center'>
        <mat-form-field appearance="fill" *ngIf = showEdit  class='h50'  >
          <input matInput [(ngModel)]="startDate" [matDatepicker]="picker" (dateChange)="editDate('startDate', $event)" placeholder=" {{ startDateConvent }}">
          <mat-datepicker-toggle matSuffix [for]="picker"    ></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
        </td>
     <td class='h50' >
      <div class='center'>
      <mat-form-field appearance="fill"  class='h50'  >
        <input matInput [(ngModel)]="startDate" [matDatepicker]="picker2" (dateChange)="editDate('endDate', $event)" placeholder=" {{ endDateConvent}}">
        <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
        <mat-datepicker #picker2></mat-datepicker>
      </mat-form-field>
      </div>
      </td>
        <td class='h50' >
          <div class='center'> 
          <mat-form-field appearance="fill">
            <mat-select (selectionChange)="editTaParams( 'reasonIdx', $event)"  [value]="selectedOption">
              <mat-option value="1">Personal Vacation</mat-option>
              <mat-option value="2" >Meeting </mat-option>
              <mat-option value="3">Other </mat-option>
            </mat-select>
          </mat-form-field>
          </div>
        </td>
        <td class='h50' >
          <div class='center'>
            <mat-form-field class="example-full-width" appearance="fill">
              <mat-label>Note</mat-label>
              <input matInput [value] = "tAparams['note']" (change) = "editTaParams('note', $event.target.value)" >
            </mat-form-field>
          </div>
        </td>
        <td class='h50' >
          <div class='center'>
          <table>
          <tr><td>
          <button class='Button' (click) = "saveEdits($event)">Save Changes</button>
        </td></tr>  
        <tr><td>
          <button  class='Button' (click) = "deleteTa($event)">Delete Time Away</button>
        </td></tr>
        </table>  
          </div>
        </td>
       </tr>
       <tr>
        <th> Coverer </th> <th> WTM Date </th>  <th> WTM Note </th>
       </tr>
      </table>
  </div>
  <div class='raised' *ngIf = 'showReadOnly ' >
    <table class='toFit' *ngIf = showReadOnly>
      <caption> {{ theCaption }}  </caption>
      <tr >
          <th> Start Date</th><th> End Date</th> <th> Reason {{ vidxToEdit }} </th> <th> Note </th>
      </tr> 
      <tr>
          <td>  {{ startDateConvent }} </td> <td>  {{ endDateConvent }} </td> <td>{{ reasonArr[reasonIdx] }} </td> <td>{{ vacEdit['note'] }} </td>
      </tr>
    </table> 
   </div>
   <div *ngIf = 'isLoggedInUserCoverer' class='raised'> 
    <table *ngIf = vidxToSee class='toFit'>
      <caption> Please Accept or Decline this coverage for Dr. {{ toSeeParams['goAwayerLastName']  }}  time away. </caption>
      <tr >
        <th> Start Date</th><th> End Date</th> <th> Coverage</th><th> WTM Date</th><th> WTM Note</th>
          </tr> 
          <tr>
            <td>  {{ toSeeParams['startDateConvent'] }} </td> <td>  {{toSeeParams['endDateConvent']}} </td> 
            <td >   
                <mat-radio-group>
                  <mat-radio-button class="example-margin" value="accept" [checked] ="covAccepted" (click) = "editTaParams('CovAccepted', 1)" >Accept</mat-radio-button>
                  <mat-radio-button class="example-margin" value="decline"  (click) = "editTaParams('CovAccepted', 0)" >Decline</mat-radio-button>
                </mat-radio-group>
            </td> 
       
            <td> 
              <mat-form-field  class='h50'  >
                <input matInput [(ngModel)]="startDate" [matDatepicker]="picker3" (dateChange)="editTaParams('WTMdate', $event)" placeholder=" {{ toSeeParams['WTMDateConvent'] }}">
                <mat-datepicker-toggle matSuffix [for]="picker3"    ></mat-datepicker-toggle>
                <mat-datepicker #picker3></mat-datepicker>
              </mat-form-field>
            </td>
            <td> 
               <mat-form-field class="example-full-width" >
                <textarea matInput (change) = "editTaParams('WTMnote', $event.target.value)" class='note'  > {{ WTMnote }} </textarea>
               </mat-form-field>
            </td>
            <td>
              <table>
                 <tr><td><button class='Button' (click) = "saveEdits($event, 'CovAccept')">Save </button></td></tr>
                 <tr ><td> {{ acknowlegeEdits }}</td></tr>
              
             </table>
            </td>
        </tr>
    </table>

  </div>
</div>

<br><br>
<div>
  <app-enterta (onDatePicked) = "refreshData($event)"  ></app-enterta>
  </div>